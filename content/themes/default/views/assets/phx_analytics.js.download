(()=>{"use strict";function e(e,t,r){try{if(document){var a=document.createElement("img"),n="https://adlog.bangms.net/remotelog/get?".concat(e,"&action=").concat(t,"&msg=").concat(r,"&landUrl=").concat(window.location.href);a.src=n,a.onload=function(){a=null},a.onerror=function(){a=null}}}catch(e){o("sendReport error",e)}}function t(r,a,n){var l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3;try{if(document){var c=document.createElement("img");c.src=r,c.onload=function(){e(r.split("?")[1],"report-success","image-request-success_report-success"),"function"==typeof a&&a(r),c=null},c.onerror=function(){e(r.split("?")[1],"report-failed","image-request-failed"),l>1?t(r,a,n,--l):("function"==typeof n&&n(r),c=null)}}}catch(t){o("sendReport error",t),e(r.split("?")[1],"report-failed","image-request-failed")}}var r="phx_ad_deep_param",a=function(e,t){try{var r=new URLSearchParams(e),a=decodeURIComponent(r.get(t));if(a&&"null"!==a){var n=function(e){var t=new URL(e),r={};return t.search.slice(1).split("&").forEach((function(e){var t=e.split("=");r[t[0]]=decodeURIComponent(t[1])})),r}(new URL("http://test.com?".concat(a)).href),l=n.event_report_url;return delete n.event_report_url,{param:n,callbackUrl:l}}return}catch(e){return void o("parsePhxAdParamFromSearch error",e)}},n=-1!==window.location.href.indexOf("phxDebug"),o=function(){if(n){var e=Array.from(arguments);e.unshift("[PhxAnalytics]"),console.log.apply(window,e)}};function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){u(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function s(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function u(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var p={event_name:{},event_id:{},event_type:{},event_num:{},event_time:{}},f="PHX_DEEP_EVENT_STORE",h=new(function(){function n(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),u(this,"callbackUrl",""),u(this,"callParams",null),this.parseTransparentParam(),this.handleAlreadyPushReport(),this.loopStorageAndReport()}var l,h;return l=n,h=[{key:"handleAlreadyPushReport",value:function(){var e=this;try{if(this.callbackUrl&&this.callParams&&window.phxAnalytics&&window.phxAnalytics.data&&window.phxAnalytics.data.length){var t=[];try{t=JSON.parse(localStorage.getItem(f))||[]}catch(e){o("handleAlreadyPushReport parse error",e)}window.phxAnalytics.data.forEach((function(r){var a,n,o=(a=Array.from(r),n=1,function(e){if(Array.isArray(e))return e}(a)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,o=[],l=!0,c=!1;try{for(r=r.call(e);!(l=(a=r.next()).done)&&(o.push(a.value),!t||o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{l||null==r.return||r.return()}finally{if(c)throw n}}return o}}(a,n)||function(e,t){if(e){if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}(a,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[0],l=void 0===o?{}:o;l.event_time=Math.floor(Date.now()/1e3),t.unshift({props:l,callParams:e.callParams,callbackUrl:e.callbackUrl})})),localStorage.setItem(f,JSON.stringify(t))}}catch(e){o("handleAlreadyPushReport error",e)}}},{key:"parseTransparentParam",value:function(){var e=function(e){try{var t=a(window.location.search,e);if(t)return localStorage.setItem(r,JSON.stringify(t)),t;var n=window.location.hash,l=n.slice(n.indexOf("?")),c=a(l,e);if(c)return localStorage.setItem(r,JSON.stringify(c)),c}catch(e){return o("getPhxAdCallbackParamFromUrl error",e),!1}}("PXH_AD_DEEP_EVENT")||{},t=e.callbackUrl,n=e.param;if(!t){var l=function(){try{return JSON.parse(localStorage.getItem(r))}catch(e){return null}}();l&&(t=l.callbackUrl,n=l.param)}o("getPhxAdCallbackParamFromUrl",t,n),this.callbackUrl=t,this.callParams=n}},{key:"report",value:function(r){var a=r.props,n=r.callback,l=r.callbackUrl,i=r.callParams,s=a.eventName,u=a.eventId,f=a.eventType,h=a.eventNum,m=a.EventName,d=a.EventId,y=a.EventType,v=a.EventNum,g=a.actionId,b=a.actionName,P=a.actionType,w=a.actionNum,S=a.ActionId,O=a.ActionName,_=a.ActionType,k=a.ActionNum,A="";try{var U=n||{},E=U.onload,I=void 0===E?function(){}:E,N=U.onerror,j=void 0===N?function(){}:N;if(l){var R=b||O||s||m,x="1"==(g||S)?50:null,D="2"===(g||S)?51:null,T=i.event_id,J=x||D||("__event_id__"!==T&&T?T:null)||u||d,C=P||_||f||y,F=w||k||h||v,M=function(e,t){try{return Object.keys(e).forEach((function(r){p[r]&&(t[r]?e[r]=t[r]:delete e[r])})),e}catch(e){return o("replaceCallbackParam err"),{}}}(c({},i),{event_name:R,event_id:J,event_type:C,event_num:F});M.send_time=Math.floor(Date.now()/1e3),M.event_time=a.event_time||M.send_time,o("valiableParam",M),A="",Object.keys(M).forEach((function(e){A+="&".concat(e,"=").concat(encodeURIComponent(M[e]))})),A=A.slice(1)+"&t=".concat(+Date.now()),o("fanliy report","".concat(l,"?").concat(A)),t("".concat(l,"?").concat(A),I,j)}}catch(t){console.warn("[PhxAnalytics] deep param not exist"),e(A,"report-failed","deep-param-not-exist_report-failed")}}},{key:"push2Storage",value:function(e){var t=e.props,r=e.callbackUrl,a=e.callParams;try{var n=JSON.parse(localStorage.getItem(f))||[];n.push({props:t,callbackUrl:r,callParams:a}),o("push2Storage push"),localStorage.setItem(f,JSON.stringify(n))}catch(e){o("push2Storage catch"),localStorage.setItem(f,JSON.stringify([{props:t,callbackUrl:r,callParams:a}]))}}},{key:"popReadyPointFromStorage",value:function(){try{var e=JSON.parse(localStorage.getItem(f))||[],t=e.shift();return localStorage.setItem(f,JSON.stringify(e)),t}catch(e){return localStorage.setItem(f,[]),null}}},{key:"push",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.callbackUrl&&e){e.event_time=Math.floor(Date.now()/1e3);var a=c(c({},r),{},{onerror:function(a){"function"==typeof r.onerror&&r.onerror(a),o("push2Storage onerror"),t.push2Storage({props:e,callbackUrl:t.callbackUrl,callParams:t.callParams})}});this.report({props:e,callback:a,callbackUrl:this.callbackUrl,callParams:this.callParams})}}},{key:"loopStorageAndReport",value:function(){var e=this,t=this;setInterval((function(){try{var r=e.popReadyPointFromStorage();r&&t.report(c(c({},r),{},{callback:{onerror:function(){t.push2Storage(r)}}}))}catch(e){o("loopStorageAndReport err",e)}}),1e3)}}],h&&s(l.prototype,h),Object.defineProperty(l,"prototype",{writable:!1}),n}());window.phxAnalytics={deepUrlReport:function(){h.push.apply(h,arguments)}}})();